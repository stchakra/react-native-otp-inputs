"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"OtpInputsRef",{enumerable:true,get:function get(){return _types.OtpInputsRef;}});exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _OtpInput=_interopRequireDefault(require("./OtpInput"));var _types=require("./types");var _helpers=require("./helpers");var _jsxFileName="/Users/damiansznajder/Private/OSS/otp-inputs/src/index.tsx";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){(0,_defineProperty2.default)(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}var ACTION_TYPES={setHandleChange:'setHandleChange',setOtpTextForIndex:'setOtpTextForIndex',setOtpCode:'setOtpCode',clearOtp:'clearOtp',setHasKeySupport:'setHasKeySupport'};var reducer=function reducer(state,_ref){var type=_ref.type,payload=_ref.payload;switch(type){case ACTION_TYPES.setOtpTextForIndex:{var _otpCode=_objectSpread({},state.otpCode,(0,_defineProperty2.default)({},"".concat(payload.index),payload.text));state.handleChange(Object.values(_otpCode).join(''));return _objectSpread({},state,{otpCode:_otpCode});}case ACTION_TYPES.setOtpCode:{var _otpCode2=(0,_helpers.fillOtpCode)(payload.numberOfInputs,payload.code);state.handleChange(Object.values(_otpCode2).join(''));return _objectSpread({},state,{otpCode:_otpCode2});}case ACTION_TYPES.clearOtp:{var _otpCode3=(0,_helpers.fillOtpCode)(payload);state.handleChange(Object.values(_otpCode3).join(''));return _objectSpread({},state,{otpCode:_otpCode3});}case ACTION_TYPES.setHandleChange:{return _objectSpread({},state,{handleChange:payload});}case ACTION_TYPES.setHasKeySupport:{return _objectSpread({},state,{hasKeySupport:payload});}default:return state;}};var styles=_reactNative.StyleSheet.create({container:{flex:1,flexDirection:'row',alignItems:'center',justifyContent:'space-between'}});var OtpInputs=(0,_react.forwardRef)(function(_ref2,ref){var _ref2$autoCapitalize=_ref2.autoCapitalize,autoCapitalize=_ref2$autoCapitalize===void 0?'none':_ref2$autoCapitalize,_ref2$clearTextOnFocu=_ref2.clearTextOnFocus,clearTextOnFocus=_ref2$clearTextOnFocu===void 0?false:_ref2$clearTextOnFocu,defaultValue=_ref2.defaultValue,focusStyles=_ref2.focusStyles,_ref2$handleChange=_ref2.handleChange,handleChange=_ref2$handleChange===void 0?console.log:_ref2$handleChange,inputContainerStyles=_ref2.inputContainerStyles,inputStyles=_ref2.inputStyles,_ref2$isRTL=_ref2.isRTL,isRTL=_ref2$isRTL===void 0?false:_ref2$isRTL,_ref2$keyboardType=_ref2.keyboardType,keyboardType=_ref2$keyboardType===void 0?'phone-pad':_ref2$keyboardType,_ref2$numberOfInputs=_ref2.numberOfInputs,numberOfInputs=_ref2$numberOfInputs===void 0?4:_ref2$numberOfInputs,_ref2$placeholder=_ref2.placeholder,placeholder=_ref2$placeholder===void 0?'':_ref2$placeholder,_ref2$secureTextEntry=_ref2.secureTextEntry,secureTextEntry=_ref2$secureTextEntry===void 0?false:_ref2$secureTextEntry,_ref2$selectTextOnFoc=_ref2.selectTextOnFocus,selectTextOnFocus=_ref2$selectTextOnFoc===void 0?true:_ref2$selectTextOnFoc,style=_ref2.style,_ref2$testIDPrefix=_ref2.testIDPrefix,testIDPrefix=_ref2$testIDPrefix===void 0?'otpInput':_ref2$testIDPrefix,restProps=(0,_objectWithoutProperties2.default)(_ref2,["autoCapitalize","clearTextOnFocus","defaultValue","focusStyles","handleChange","inputContainerStyles","inputStyles","isRTL","keyboardType","numberOfInputs","placeholder","secureTextEntry","selectTextOnFocus","style","testIDPrefix"]);var _useReducer=(0,_react.useReducer)(reducer,{},function(){return{otpCode:(0,_helpers.fillOtpCode)(numberOfInputs,defaultValue),handleChange:handleChange,hasKeySupport:_reactNative.Platform.OS==='ios'};}),_useReducer2=(0,_slicedToArray2.default)(_useReducer,2),_useReducer2$=_useReducer2[0],otpCode=_useReducer2$.otpCode,hasKeySupport=_useReducer2$.hasKeySupport,dispatch=_useReducer2[1];var previousCopiedText=(0,_react.useRef)('');var inputs=(0,_react.useRef)([]);(0,_react.useEffect)(function(){dispatch({type:ACTION_TYPES.setHandleChange,payload:handleChange});},[handleChange]);(0,_react.useImperativeHandle)(ref,function(){return{reset:function reset(){dispatch({type:ACTION_TYPES.clearOtp,payload:numberOfInputs});inputs.current.forEach(function(input){var _input$current;return input===null||input===void 0?void 0:(_input$current=input.current)===null||_input$current===void 0?void 0:_input$current.clear();});previousCopiedText.current='';_reactNative.Clipboard.setString('');},focus:function focus(){var _firstInput$current;var firstInput=inputs.current[0];firstInput===null||firstInput===void 0?void 0:(_firstInput$current=firstInput.current)===null||_firstInput$current===void 0?void 0:_firstInput$current.focus();}};},[numberOfInputs]);var _handleTextChange=function handleTextChange(text,index){if(_reactNative.Platform.OS==='android'&&!hasKeySupport||_reactNative.Platform.OS==='ios'&&text.length>1){handleInputTextChange(text,index);}};var handleInputTextChange=function handleInputTextChange(text,index){if(!text.length){handleClearInput(index);}if(text.length>1){handleClearInput(index);_reactNative.Keyboard.dismiss();return fillInputs(text);}if(text){dispatch({type:ACTION_TYPES.setOtpTextForIndex,payload:{text:text,index:index}});focusInput(index+1);}if(index===numberOfInputs-1&&text){_reactNative.Keyboard.dismiss();}};var _handleKeyPress=function handleKeyPress(_ref3,index){var key=_ref3.nativeEvent.key;handleInputTextChange(key==='Backspace'?'':key,index);if(_reactNative.Platform.OS==='android'&&!hasKeySupport&&!isNaN(parseInt(key)))dispatch({type:ACTION_TYPES.setHasKeySupport,payload:true});};var focusInput=(0,_react.useCallback)(function(index){if(index>=0&&index<numberOfInputs){var _input$current2;var input=inputs.current[index];input===null||input===void 0?void 0:(_input$current2=input.current)===null||_input$current2===void 0?void 0:_input$current2.focus();}},[numberOfInputs]);var handleClearInput=(0,_react.useCallback)(function(inputIndex){var _input$current3;var input=inputs.current[inputIndex];input===null||input===void 0?void 0:(_input$current3=input.current)===null||_input$current3===void 0?void 0:_input$current3.clear();dispatch({type:ACTION_TYPES.setOtpTextForIndex,payload:{index:inputIndex,text:''}});focusInput(inputIndex-1);},[focusInput]);var fillInputs=(0,_react.useCallback)(function(code){dispatch({type:ACTION_TYPES.setOtpCode,payload:{numberOfInputs:numberOfInputs,code:code}});},[numberOfInputs]);var listenOnCopiedText=(0,_react.useCallback)(function _callee(){var copiedText,otpCodeValue;return _regenerator.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regenerator.default.awrap(_reactNative.Clipboard.getString());case 2:copiedText=_context.sent;otpCodeValue=Object.values(otpCode).join('');if(copiedText&&copiedText.length===numberOfInputs&&copiedText!==otpCodeValue&&copiedText!==previousCopiedText.current){previousCopiedText.current=copiedText;fillInputs(copiedText);}case 5:case"end":return _context.stop();}}});},[fillInputs,numberOfInputs,otpCode]);(0,_react.useEffect)(function(){var interval=setInterval(function(){listenOnCopiedText();},500);return function(){clearInterval(interval);};},[listenOnCopiedText,numberOfInputs]);var renderInputs=function renderInputs(){var iterationArray=Array(numberOfInputs).fill(0);return iterationArray.map(function(_,index){var inputIndex=index;if(isRTL){inputIndex=numberOfInputs-1-index;}var inputValue=otpCode["".concat(inputIndex)];if(!inputs.current[inputIndex]){inputs.current[inputIndex]=_react.default.createRef();}return _react.default.createElement(_OtpInput.default,(0,_extends2.default)({autoCapitalize:autoCapitalize,clearTextOnFocus:clearTextOnFocus,firstInput:index===0,focusStyles:focusStyles,handleKeyPress:function handleKeyPress(keyPressEvent){return _handleKeyPress(keyPressEvent,inputIndex);},handleTextChange:function handleTextChange(text){return _handleTextChange(text,inputIndex);},inputContainerStyles:inputContainerStyles,inputStyles:inputStyles,inputValue:inputValue,key:inputIndex,keyboardType:keyboardType,maxLength:_reactNative.Platform.select({android:1,ios:index===0?numberOfInputs:1}),numberOfInputs:numberOfInputs,placeholder:placeholder,ref:inputs.current[inputIndex],secureTextEntry:secureTextEntry,selectTextOnFocus:selectTextOnFocus,testID:"".concat(testIDPrefix,"-").concat(inputIndex)},restProps,{__source:{fileName:_jsxFileName,lineNumber:295}}));});};return _react.default.createElement(_reactNative.View,{style:style||styles.container,__source:{fileName:_jsxFileName,lineNumber:328}},renderInputs());});var _default=OtpInputs;exports.default=_default;
//# sourceMappingURL=index.js.map